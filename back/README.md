# Документация по API бэкенда

Этот документ описывает API для взаимодействия с бэкенд-сервисом.

## Базовый URL

Все эндпоинты доступны по базовому URL: `http://localhost:3080` (фронтенд с проксированием) или `http://localhost:8080` (прямое обращение к бэкенду).

## Аутентификация

Некоторые эндпоинты требуют аутентификации с помощью JWT. Токен должен быть передан в заголовке `Authorization` в формате `Bearer <token>`.

---

## Маршруты

### 1. Пользователи и Аутентификация

#### Регистрация нового пользователя

- **Метод:** `POST`
- **Путь:** `/api/auth/register`
- **Описание:** Создает нового пользователя с автоматически сгенерированным временным паролем.
- **Тело запроса (JSON):**
  ```json
  {
    "name": "John Doe",
    "email": "john.doe@example.com"
  }
  ```
- **Успешный ответ (201 Created):**
  ```json
  {
    "token": "your_jwt_token",
    "temporary_password": "abc123xyz9"
  }
  ```
- **Возможные ошибки:**
  - `400 Bad Request`: Неверные данные запроса или ошибки валидации.
  - `409 Conflict`: Пользователь с таким email уже существует.
  - `500 Internal Server Error`: Внутренняя ошибка сервера.

---

#### Вход пользователя

- **Метод:** `POST`
- **Путь:** `/api/auth/login`
- **Описание:** Аутентифицирует пользователя и возвращает JWT токен.
- **Тело запроса (JSON):**
  ```json
  {
    "email": "john.doe@example.com",
    "password": "password123"
  }
  ```
- **Успешный ответ (200 OK):**
  ```json
  {
    "token": "your_jwt_token"
  }
  ```
- **Возможные ошибки:**
  - `400 Bad Request`: Неверные данные запроса.
  - `401 Unauthorized`: Неверные учетные данные.
  - `500 Internal Server Error`: Внутренняя ошибка сервера.

---

#### Смена пароля

- **Метод:** `POST`
- **Путь:** `/api/password/change`
- **Аутентификация:** Требуется (`Bearer Token`).
- **Описание:** Позволяет пользователю сменить пароль (например, с временного на постоянный).
- **Тело запроса (JSON):**
  ```json
  {
    "old_password": "abc123xyz9",
    "new_password": "myNewPassword123"
  }
  ```
- **Успешный ответ (200 OK):**
  ```json
  {
    "message": "password updated successfully"
  }
  ```
- **Возможные ошибки:**
  - `400 Bad Request`: Неверные данные запроса или новый пароль слишком короткий (минимум 8 символов).
  - `401 Unauthorized`: Ошибка аутентификации или неверный старый пароль.
  - `404 Not Found`: Пользователь не найден.
  - `500 Internal Server Error`: Внутренняя ошибка сервера.

---

#### Валидация одного токена

- **Метод:** `POST`
- **Путь:** `/api/auth/validate-token`
- **Описание:** Проверяет валидность одного JWT токена и возвращает информацию о пользователе.
- **Тело запроса (JSON):**
  ```json
  {
    "token": "user_jwt_token"
  }
  ```
- **Успешный ответ (200 OK):**
  ```json
  {
    "message": "not implemented"
  }
  ```
- **Возможные ошибки:**
  - `501 Not Implemented`: Эндпоинт пока не реализован.

---

#### Валидация нескольких токенов

- **Метод:** `POST`
- **Путь:** `/api/auth/validate-tokens`
- **Описание:** Проверяет валидность списка JWT токенов и возвращает информацию о валидных аккаунтах.
- **Тело запроса (JSON):**
  ```json
  {
    "tokens": ["token1", "token2", "invalid_token"]
  }
  ```
- **Успешный ответ (200 OK):**
  ```json
  {
    "message": "not implemented"
  }
  ```
- **Возможные ошибки:**
  - `501 Not Implemented`: Эндпоинт пока не реализован.

---

#### Получение профиля пользователя

- **Метод:** `GET`
- **Путь:** `/api/profile`
- **Аутентификация:** Требуется (`Bearer Token`).
- **Описание:** Возвращает информацию о текущем аутентифицированном пользователе.
- **Успешный ответ (200 OK):**
  ```json
  {
    "id": "user_uuid",
    "email": "john.doe@example.com",
    "name": "John Doe",
    "created_at": "timestamp"
  }
  ```
- **Возможные ошибки:**
  - `401 Unauthorized`: Ошибка аутентификации.
  - `404 Not Found`: Пользователь не найден.
  - `500 Internal Server Error`: Внутренняя ошибка сервера.

---

#### Обновление профиля пользователя

- **Метод:** `PUT`
- **Путь:** `/api/profile`
- **Аутентификация:** Требуется (`Bearer Token`).
- **Описание:** Обновляет имя текущего пользователя.
- **Тело запроса (JSON):**
  ```json
  {
    "name": "Johnathan Doe"
  }
  ```
- **Успешный ответ (200 OK):**
  ```json
  {
    "message": "profile updated successfully"
  }
  ```
- **Возможные ошибки:**
  - `400 Bad Request`: Неверные данные запроса или ошибки валидации.
  - `401 Unauthorized`: Ошибка аутентификации.
  - `404 Not Found`: Пользователь не найден.
  - `500 Internal Server Error`: Внутренняя ошибка сервера.

---

### 2. Управление аккаунтами

#### Привязка аккаунта

- **Метод:** `POST`
- **Путь:** `/api/account/link`
- **Аутентификация:** Требуется (`Bearer Token`).
- **Описание:** Привязывает другой аккаунт к текущему.
- **Тело запроса (JSON):**
  ```json
  {
    "email": "another@example.com",
    "password": "password123"
  }
  ```
- **Успешный ответ (200 OK):**
  ```json
  {
    "message": "account linked successfully"
  }
  ```

---

#### Переключение аккаунта

- **Метод:** `POST`
- **Путь:** `/api/account/switch`
- **Аутентификация:** Требуется (`Bearer Token`).
- **Описание:** Переключается на привязанный аккаунт.
- **Тело запроса (JSON):**
  ```json
  {
    "target_user_id": "uuid"
  }
  ```
- **Успешный ответ (200 OK):**
  ```json
  {
    "token": "new_jwt_token"
  }
  ```

---

#### Получение привязанных аккаунтов

- **Метод:** `GET`
- **Путь:** `/api/account/links`
- **Аутентификация:** Требуется (`Bearer Token`).
- **Описание:** Возвращает список привязанных аккаунтов.
- **Успешный ответ (200 OK):**
  ```json
  [
    {
      "id": "uuid",
      "email": "user@example.com",
      "name": "User Name"
    }
  ]
  ```

---

### 3. Служебные маршруты

#### Проверка состояния сервиса

- **Метод:** `GET`
- **Путь:** `/api/health`
- **Описание:** Проверяет, что сервис запущен и работает.
- **Успешный ответ (200 OK):**
  ```json
  {
    "status": "ok",
    "timestamp": "utc_timestamp",
    "version": "1.0.0"
  }
  ```

---

## Примечания для фронтенд-разработки

### Типичный флоу регистрации и входа:

1. **Регистрация:** 
   - Отправить `POST /api/auth/register` с именем и email
   - Получить JWT токен и временный пароль
   - Сохранить токен для дальнейших запросов
   - Показать пользователю временный пароль

2. **Смена пароля:**
   - Отправить `POST /api/password/change` с временным и новым паролем
   - Использовать JWT токен в заголовке Authorization

3. **Вход:**
   - Отправить `POST /api/auth/login` с email и паролем
   - Получить JWT токен
   - Сохранить токен для дальнейших запросов

### Работа с JWT токенами:

- Все защищенные эндпоинты требуют заголовок: `Authorization: Bearer <your_jwt_token>`
- Токены не имеют срока истечения в текущей реализации
- При ошибке 401 нужно перенаправить пользователя на страницу входа 